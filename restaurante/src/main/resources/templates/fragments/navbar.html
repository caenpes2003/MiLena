<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
/>

<nav
  id="mainNavbar"
  class="navbar navbar-expand-lg navbar-dark nav-ml fixed-top py-4"
  th:fragment="navbar"
>
  <div class="container-xl">
    <!-- Marca -->
    <a
      class="navbar-brand d-flex align-items-center gap-2"
      th:href="@{/}"
      id="brandML"
    >
      <img th:src="@{/assets/Logo1.png}" alt="Mi Leña" class="logo-img me-1" />
      <img
        th:src="@{/assets/Nombre.png}"
        alt="Mi Leña"
        class="brand-name-img"
      />
    </a>

    <!-- Hamburguesa -->
    <button
      class="navbar-toggler border-0"
      type="button"
      data-bs-toggle="offcanvas"
      data-bs-target="#offcanvasNav"
      aria-controls="offcanvasNav"
      aria-expanded="false"
      aria-label="Menú"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Desktop -->
    <div
      class="collapse navbar-collapse d-none d-lg:flex position-relative"
      id="mainNavContent"
    >
      <div class="nav-marker" aria-hidden="true"></div>
      <ul class="navbar-nav mx-auto gap-3">
        <li class="nav-item">
          <a class="nav-link fw-semibold fs-5" th:href="@{/#inicio}">Inicio</a>
        </li>
        <li class="nav-item">
          <a class="nav-link fw-semibold fs-5" th:href="@{/menu}">Menú</a>
        </li>
        <li class="nav-item">
          <a class="nav-link fw-semibold fs-5" th:href="@{/#momentos}"
            >Momentos</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link fw-semibold fs-5" th:href="@{/#reservas}"
            >Reservas</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link fw-semibold fs-5" th:href="@{/#contacto}"
            >Contacto</a
          >
        </li>

        <!-- Gestión solo si hay sesión activa -->
        <div
          th:if="${session.clienteLogueado != null}"
          class="d-flex align-items-center gap-3 ms-3"
        >
          <a
            class="nav-link fs-5 d-flex align-items-center"
            th:href="@{/comidas}"
            data-bs-toggle="tooltip"
            data-bs-placement="bottom"
            title="Gestiona los platos"
          >
            <i class="bi bi-egg-fried fs-4"></i>
          </a>
          <a
            class="nav-link fs-5 d-flex align-items-center"
            th:href="@{/clientes}"
            data-bs-toggle="tooltip"
            data-bs-placement="bottom"
            title="Gestiona los clientes"
          >
            <i class="bi bi-people fs-4"></i>
          </a>
          <a
            class="nav-link fs-5 d-flex align-items-center"
            th:href="@{/adicionales}"
            data-bs-toggle="tooltip"
            data-bs-placement="bottom"
            title="Gestiona los adicionales"
          >
            <i class="bi bi-plus-square fs-4"></i>
          </a>
        </div>

        <li class="nav-item">
          <a href="/login" class="nav-link position-relative">
            <i class="bi bi-cart fs-4"></i>
            <span
              id="cartBadge"
              class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger text-white shadow-sm d-none"
              style="font-size: 0.75rem; min-width: 20px"
            >
              0
            </span>
          </a>
        </li>
      </ul>

      <!-- Botones de autenticación -->
      <div class="d-flex align-items-center gap-2">
        <!-- Si NO está logueado -->
        <div th:if="${session.clienteLogueado == null}">
          <a th:href="@{/login}" class="btn btn-pill-outline-auth btn-ripple">
            Iniciar sesión
          </a>
          <a th:href="@{/register}" class="btn btn-pill-solid-auth btn-ripple">
            Regístrate
          </a>
        </div>

        <!-- Si SÍ está logueado -->
        <div
          th:unless="${session.clienteLogueado == null}"
          class="d-flex align-items-center gap-2"
        >
          <span class="text-white me-2" th:text="${session.clienteNombre}"
            >Usuario</span
          >
          <a th:href="@{/perfil}" class="btn btn-outline-light btn-sm">
            <i class="bi bi-person"></i> Mi Perfil
          </a>
          <a th:href="@{/logout}" class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-box-arrow-right"></i> Salir
          </a>
        </div>
      </div>
    </div>

    <!-- Offcanvas móvil -->
    <div
      class="offcanvas offcanvas-end bg-primario text-white d-lg-none"
      tabindex="-1"
      id="offcanvasNav"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title">Mi Leña</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="offcanvas"
        ></button>
      </div>
      <div class="offcanvas-body">
        <ul class="navbar-nav gap-2">
          <li><a class="nav-link" th:href="@{'/' + '#inicio'}">Inicio</a></li>
          <li><a class="nav-link" th:href="@{/menu}">Menú</a></li>
          <li>
            <a class="nav-link" th:href="@{'/' + '#momentos'}">Momentos</a>
          </li>
          <li>
            <a class="nav-link" th:href="@{'/' + '#reservas'}">Reservas</a>
          </li>
          <li>
            <a class="nav-link" th:href="@{'/' + '#contacto'}">Contacto</a>
          </li>

          <!-- Admin links móvil -->
          <div
            th:if="${session.clienteLogueado != null}"
            class="d-flex gap-3 mt-3"
          >
            <a
              class="nav-link text-warning fs-4"
              th:href="@{/comidas}"
              data-bs-toggle="tooltip"
              data-bs-placement="bottom"
              title="Administra comidas"
            >
              <i class="bi bi-egg-fried"></i>
            </a>
            <a
              class="nav-link text-warning fs-4"
              th:href="@{/clientes}"
              data-bs-toggle="tooltip"
              data-bs-placement="bottom"
              title="Administra clientes"
            >
              <i class="bi bi-people"></i>
            </a>
            <a
              class="nav-link text-warning fs-4"
              th:href="@{/adicionales}"
              data-bs-toggle="tooltip"
              data-bs-placement="bottom"
              title="Administra adicionales"
            >
              <i class="bi bi-plus-square"></i>
            </a>
          </div>
        </ul>

        <!-- Botones móvil -->
        <div class="mt-3 d-grid gap-2">
          <!-- Si NO está logueado -->
          <div th:if="${session.clienteLogueado == null}">
            <a th:href="@{/login}" class="btn btn-pill-outline-auth w-100">
              Iniciar sesión
            </a>
            <a th:href="@{/register}" class="btn btn-pill-solid-auth w-100">
              Regístrate
            </a>
          </div>

          <!-- Si SÍ está logueado -->
          <div th:unless="${session.clienteLogueado == null}">
            <p
              class="text-white mb-2"
              th:text="'Hola, ' + ${session.clienteNombre}"
            >
              Hola, Usuario
            </p>
            <a th:href="@{/perfil}" class="btn btn-outline-light w-100 mb-2">
              Mi Perfil
            </a>
            <a th:href="@{/logout}" class="btn btn-outline-secondary w-100">
              Cerrar Sesión
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>
