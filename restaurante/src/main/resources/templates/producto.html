<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title th:text="'Mi Leña – ' + ${item.nombre}">Mi Leña – Producto</title>
    <link rel="icon" th:href="@{/assets/favicon.png}" />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Iconos -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />

    <!-- CSS personalizado -->
    <link rel="stylesheet" th:href="@{/css/custom.css?v=1}" />
  </head>
  <body>
    <!-- Loader -->
    <div id="pageLoader" class="page-loader hidden" aria-hidden="true">
      <div class="page-loader-inner">
        <img th:src="@{/assets/Logo1.png}" alt="Mi Leña" class="loader-logo" />
        <div class="loader-text">Cargando…</div>
      </div>
    </div>

    <!-- NAVBAR -->
    <nav th:replace="fragments/navbar :: navbar"></nav>

    <main class="pt-5 mt-5 product-hero">
      <section class="py-5">
        <div class="container-xl">
          <div class="row g-4 align-items-center">
            <!-- Imagen -->
            <div class="col-md-6 text-center">
              <img
                th:src="${item.imagenUrl}"
                th:alt="${item.nombre}"
                class="img-fluid rounded shadow-lg animate-zoom"
              />
            </div>

            <!-- Información -->
            <div class="col-md-6 text-center text-md-start">
              <h1 class="mb-3 fw-bold text-white" th:text="${item.nombre}">
                Nombre
              </h1>
              <p class="lead mb-4" th:text="${item.descripcion}">Descripción</p>
              <h3 class="text-acento fw-bold mb-4">
                <span class="badge bg-primario text-white fs-5 px-3 py-2">
                  $<span
                    th:text="${#numbers.formatInteger(item.precio, 0, 'POINT')}"
                  ></span>
                </span>
              </h3>

              <!-- Adicionales -->
              <div
                th:if="${adicionales != null and !adicionales.empty}"
                class="mb-4"
              >
                <h4 class="h5 text-white mb-3">
                  <i class="bi bi-plus-circle-fill text-acento"></i>
                  Adicionales disponibles
                </h4>
                <div class="row g-2">
                  <div class="col-md-6" th:each="adicional : ${adicionales}">
                    <div class="card bg-dark text-white border-secondary">
                      <div class="card-body py-2 px-3">
                        <div
                          class="d-flex justify-content-between align-items-center"
                        >
                          <div>
                            <h6
                              class="card-title mb-1 fs-6"
                              th:text="${adicional.nombre}"
                            >
                              Adicional
                            </h6>
                            <small
                              class="text-muted"
                              th:if="${adicional.descripcion}"
                              th:text="${adicional.descripcion}"
                              >Descripción</small
                            >
                          </div>
                          <span
                            class="badge bg-acento text-dark fw-bold"
                            th:text="${adicional.precioFormateado}"
                            >$0</span
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Botones -->
              <div
                class="d-flex flex-wrap justify-content-center justify-content-md-start gap-3"
              >
                <a href="/comidas" class="btn btn-outline-light">
                  <i class="bi bi-arrow-left"></i> Volver al menú
                </a>
                <button
                  class="btn btn-primario"
                  data-bs-toggle="modal"
                  data-bs-target="#modalCarrito"
                >
                  <i class="bi bi-cart-plus"></i> Añadir al carrito
                </button>
                <a href="/login" class="btn btn-success">
                  <i class="bi bi-lightning-fill"></i> Comprar ahora
                </a>
              </div>
            </div>
          </div>

          <!-- Productos relacionados -->
          <section
            class="mt-5"
            th:if="${productosRelacionados != null and !productosRelacionados.empty}"
          >
            <h4 class="mb-4 fw-semibold text-white">
              También te puede interesar
            </h4>
            <div class="row g-4">
              <div class="col-md-4" th:each="rel : ${productosRelacionados}">
                <div
                  class="card bg-dark text-white border-secondary shadow-sm h-100 hover-card"
                >
                  <img
                    th:src="${rel.imagenUrl}"
                    class="card-img-top"
                    th:alt="${rel.nombre}"
                    style="height: 200px; object-fit: cover"
                  />
                  <div class="card-body text-center">
                    <h5 class="card-title fw-bold" th:text="${rel.nombre}">
                      Producto
                    </h5>
                    <p class="text-acento fw-semibold">
                      $<span
                        th:text="${#numbers.formatInteger(rel.precio, 0, 'POINT')}"
                      ></span>
                    </p>
                    <a
                      th:href="@{/producto/{slug}(slug=${rel.slug})}"
                      class="btn btn-sm btn-outline-primario"
                      >Ver producto</a
                    >
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </section>
    </main>

    <!-- Modal carrito -->
    <div
      class="modal fade"
      id="modalCarrito"
      tabindex="-1"
      aria-labelledby="modalCarritoLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-primario text-white">
            <h5 class="modal-title" id="modalCarritoLabel">
              <i class="bi bi-check-circle-fill"></i> Producto añadido
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body text-center">
            <p th:text="${item.nombre}">Producto</p>
            <p class="text-muted">Ha sido añadido al carrito correctamente.</p>

            <!-- Mostrar adicionales en el modal si los hay -->
            <div
              th:if="${adicionales != null and !adicionales.empty}"
              class="mt-3"
            >
              <small class="text-muted">
                <i class="bi bi-info-circle"></i>
                No olvides seleccionar tus adicionales favoritos
              </small>
            </div>
          </div>
          <div class="modal-footer d-flex justify-content-between">
            <a href="/comidas" class="btn btn-outline-primario">
              Seguir comprando
            </a>
            <a href="/login" class="btn btn-primario"> Ir al carrito </a>
          </div>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer th:replace="fragments/footer :: footer"></footer>

    <!-- Botón flotante Whatsapp -->
    <a
      href="https://wa.me/573016113151"
      target="_blank"
      id="btnWhatsappFlotante"
      class="btn-wsp"
      ><i class="bi bi-whatsapp"></i
    ></a>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/main.js}"></script>
  </body>
</html>
