<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cambiar Contraseña - Mi Leña</title>
    <link rel="icon" th:href="@{/assets/favicon.png}" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" th:href="@{/css/custom.css}" />
  </head>
  <body>
    <nav th:replace="~{fragments/navbar :: navbar}"></nav>

    <main class="site-main">
      <section class="py-5 bg-dark bg-pattern text-white">
        <div class="container-xl">
          <div class="row justify-content-center">
            <div class="col-lg-6">
              <!-- Mensajes Flash -->
              <div
                th:if="${error}"
                class="alert alert-danger alert-dismissible fade show"
                role="alert"
              >
                <i class="bi bi-exclamation-triangle me-2"></i>
                <span th:text="${error}">Mensaje de error</span>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="alert"
                ></button>
              </div>

              <!-- Encabezado -->
              <div class="text-center mb-4">
                <h2 class="text-acento mb-2">
                  <i class="bi bi-key"></i> Cambiar Contraseña
                </h2>
                <p class="text-white-75">
                  Cliente:
                  <strong th:text="${cliente.nombreCompleto}"
                    >Nombre del Cliente</strong
                  >
                </p>
              </div>

              <!-- Formulario -->
              <div class="card-ml p-4">
                <form
                  th:action="@{/clientes/cambiar-password/{id}(id=${cliente.id})}"
                  method="post"
                  novalidate
                  class="needs-validation"
                  id="formCambiarPassword"
                >
                  <div class="mb-3">
                    <label for="password" class="form-label fw-semibold">
                      Nueva Contraseña *
                    </label>
                    <div class="input-group">
                      <input
                        type="password"
                        class="form-control"
                        id="password"
                        name="password"
                        required
                        minlength="8"
                        placeholder="Mínimo 8 caracteres"
                      />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        id="togglePassword1"
                        title="Mostrar/Ocultar contraseña"
                      >
                        <i class="bi bi-eye" id="toggleIcon1"></i>
                      </button>
                    </div>
                    <div class="invalid-feedback">
                      La contraseña debe tener al menos 8 caracteres
                    </div>
                  </div>

                  <div class="mb-4">
                    <label for="password2" class="form-label fw-semibold">
                      Confirmar Contraseña *
                    </label>
                    <div class="input-group">
                      <input
                        type="password"
                        class="form-control"
                        id="password2"
                        name="password2"
                        required
                        minlength="8"
                        placeholder="Repita la contraseña"
                      />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        id="togglePassword2"
                        title="Mostrar/Ocultar contraseña"
                      >
                        <i class="bi bi-eye" id="toggleIcon2"></i>
                      </button>
                    </div>
                    <div class="invalid-feedback" id="password2Error">
                      Las contraseñas no coinciden
                    </div>
                  </div>

                  <!-- Requisitos de contraseña -->
                  <div class="alert alert-info mb-4">
                    <h6 class="alert-heading">
                      <i class="bi bi-info-circle"></i> Requisitos de
                      contraseña:
                    </h6>
                    <ul class="mb-0 small">
                      <li>Mínimo 8 caracteres</li>
                      <li>Se recomienda usar letras, números y símbolos</li>
                      <li>Evite usar información personal fácil de adivinar</li>
                    </ul>
                  </div>

                  <!-- Botones -->
                  <div class="d-flex gap-3 justify-content-end">
                    <a th:href="@{/clientes}" class="btn btn-outline-secondary">
                      <i class="bi bi-arrow-left"></i> Cancelar
                    </a>
                    <button type="submit" class="btn btn-success">
                      <i class="bi bi-check-lg"></i> Cambiar Contraseña
                    </button>
                  </div>
                </form>
              </div>

              <!-- Información adicional -->
              <div class="text-center mt-4">
                <small class="text-white-75">
                  <i class="bi bi-shield-check"></i>
                  La contraseña será actualizada de forma segura
                </small>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer th:replace="~{fragments/footer :: footer}"></footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/main.js}"></script>

    <!-- Script para validación y mostrar/ocultar contraseñas -->
    <script>
      // Toggle mostrar/ocultar contraseña
      document
        .getElementById("togglePassword1")
        .addEventListener("click", function () {
          const passwordInput = document.getElementById("password");
          const icon = document.getElementById("toggleIcon1");

          if (passwordInput.type === "password") {
            passwordInput.type = "text";
            icon.classList.remove("bi-eye");
            icon.classList.add("bi-eye-slash");
          } else {
            passwordInput.type = "password";
            icon.classList.remove("bi-eye-slash");
            icon.classList.add("bi-eye");
          }
        });

      document
        .getElementById("togglePassword2")
        .addEventListener("click", function () {
          const passwordInput = document.getElementById("password2");
          const icon = document.getElementById("toggleIcon2");

          if (passwordInput.type === "password") {
            passwordInput.type = "text";
            icon.classList.remove("bi-eye");
            icon.classList.add("bi-eye-slash");
          } else {
            passwordInput.type = "password";
            icon.classList.remove("bi-eye-slash");
            icon.classList.add("bi-eye");
          }
        });

      // Validación de contraseñas coincidentes
      document
        .getElementById("formCambiarPassword")
        .addEventListener("submit", function (e) {
          const password = document.getElementById("password").value;
          const password2 = document.getElementById("password2").value;
          const password2Input = document.getElementById("password2");
          const errorDiv = document.getElementById("password2Error");

          if (password !== password2) {
            e.preventDefault();
            password2Input.classList.add("is-invalid");
            errorDiv.style.display = "block";
            return false;
          }

          if (password.length < 8) {
            e.preventDefault();
            document.getElementById("password").classList.add("is-invalid");
            return false;
          }

          return true;
        });

      // Validación en tiempo real
      document
        .getElementById("password2")
        .addEventListener("input", function () {
          const password = document.getElementById("password").value;
          const password2 = this.value;
          const errorDiv = document.getElementById("password2Error");

          if (password2.length > 0 && password !== password2) {
            this.classList.add("is-invalid");
            errorDiv.style.display = "block";
          } else {
            this.classList.remove("is-invalid");
            errorDiv.style.display = "none";
          }
        });
    </script>
  </body>
</html>
